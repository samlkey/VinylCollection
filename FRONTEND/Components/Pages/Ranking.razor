@page "/ranking"
@rendermode InteractiveServer
@using FRONTEND.Services
@using FRONTEND.Data
@using FRONTEND.Components.Shared
@inject IVinylService VinylService

<div class="container">
    <Search />
    <div class="albums-grid">
        <div class="albums-grid-wrapper">
            @for (int i = 0; i < albums.Count; i++)
            {
                var album = albums[i];
                <div class="album-card">
                    <img src="@album.ImgSrc" alt="@album.Name" class="album-art">
                    <div class="album-info">
                        <div class="album-credits">
                            <h3>@album.Name</h3>
                            <p class="artist">@album.Artist</p>
                        </div>
                        <p class="rating">@album.GetStars(album.Rating)</p>
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="stats-container">
        <h2>STATS</h2>
        <ul>
            <li><strong>Total Albums:</strong> <span>@albums.Count</span></li>
            <li><strong>Average Rating:</strong> <span>@(albums.Count > 0 ? albums.Average(a => a.Rating).ToString("0.00") : "N/A")</span></li>
            <li><strong>Highest Rated Album:</strong> <span>@(albums.Count > 0 ? albums.OrderByDescending(a => a.Rating).First().Name : "N/A")</span></li>
            <li><strong>Lowest Rated Album:</strong> <span>@(albums.Count > 0 ? albums.OrderBy(a => a.Rating).First().Name : "N/A")</span></li>
            <li><strong>Most Popular Artist:</strong> <span>@(albums.Count > 0 ? albums.GroupBy(a => a.Artist).OrderByDescending(g => g.Count()).ThenBy(g => g.Key).First().Key : "N/A")</span></li>
            <li><strong>Oldest Album:</strong> <span>@(albums.Count > 0 ? albums.OrderBy(a => a.Release).First().Name + " (" + albums.OrderBy(a => a.Release).First().Release + ")" : "N/A")</span></li>
            <li><strong>Newest Album:</strong> <span>@(albums.Count > 0 ? albums.OrderByDescending(a => a.Release).First().Name + " (" + albums.OrderByDescending(a => a.Release).First().Release + ")" : "N/A")</span></li>
        </ul>
    </div>
</div>

@code {
    private List<Album> albums = new List<Album>();

    protected override async Task OnInitializedAsync() {
        albums = await VinylService.GetAllAlbumsAsync(); 
        albums = albums.OrderByDescending(a => a.Rating).ToList();
    }

    string GetOrdinal(int number)
    {
        if (number <= 0) return number.ToString();
        int rem100 = number % 100;
        if (rem100 >= 11 && rem100 <= 13) return number + "th";
        switch (number % 10)
        {
            case 1: return number + "st";
            case 2: return number + "nd";
            case 3: return number + "rd";
            default: return number + "th";
        }
    }
}    